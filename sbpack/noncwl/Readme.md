# sbpack_wdl
Developed to support WDL workflows on Seven Bridges Platform. 
This command enables users to create and upload WDL workflows
to the Platform.

### Usage
```
$ sbpack_wdl -h

usage: sbpack_wdl [-h] [--profile PROFILE] --appid APPID --entrypoint ENTRYPOINT --workflow-path WORKFLOW_PATH [--sb-package-id SB_PACKAGE_ID] [--womtool-input WOMTOOL_INPUT] [--sb-doc SB_DOC] [--dump-sb-app] [--no-package]
                  [--womtool-path WOMTOOL_PATH] [--json] [--sb-schema SB_SCHEMA]

optional arguments:
  -h, --help            show this help message and exit
  --profile PROFILE     SB platform profile as set in the SB API credentials file.
  --appid APPID         Takes the form {user or division}/{project}/{app_id}.
  --entrypoint ENTRYPOINT
                        Relative path to the workflow from the main workflow directory
  --workflow-path WORKFLOW_PATH
                        Path to the main workflow directory
  --sb-package-id SB_PACKAGE_ID
                        Id of an already uploaded package
  --womtool-input WOMTOOL_INPUT
                        Path to inputs .JSON generated by womtool
  --sb-doc SB_DOC       Path to a doc file for sb app. If not provided, README.md will be used if available
  --dump-sb-app         Dump created sb app to file if true and exit
  --no-package          Only provide a sb app schema and a git URL for entrypoint
  --womtool-path WOMTOOL_PATH
                        Path to womtool-X.jar
  --json                Dump sb app schema in JSON format (YAML by default)
  --sb-schema SB_SCHEMA
                        Do not create new schema, use this schema file. It is sb_wdl_schema in JSON or YAML format.
```

### Example

```
$ sbpack_wdl --profile default --workflow-path /path/to/workflow_dir 
--appid user/project/app --entrypoint workflow.wdl 
--womtool-path /path/to/womtool-X.jar
```

# sbpack_nf
Developed to support Nextflow workflows on Seven Bridges Platform. 
This command enables users to create and upload Nextflow workflows
to the Platform.

### Usage
```
$ sbpack_nf -h

usage: sbpack_nf [-h]
                 [--profile PROFILE]
                 [--appid APPID]
                 --workflow-path WORKFLOW_PATH
                 [--entrypoint ENTRYPOINT]
                 [--sb-package-id SB_PACKAGE_ID]
                 [--sb-doc SB_DOC]
                 [--dump-sb-app]
                 [--executor-version EXECUTOR_VERSION]
                 [--execution-mode {single-instance,multi-instance}]
                 [--json]
                 [--sb-schema SB_SCHEMA]
                 [--revision-note REVISION_NOTE]
                 [--app-name APP_NAME]
                 [--exclude EXCLUDE [EXCLUDE ...]]
                 [--sample-sheet-schema SAMPLE_SHEET_SCHEMA]
                 [--auto]

optional arguments:
  -h, --help            show this help message and exit
  --profile PROFILE     SB platform profile as set in the SB API credentials
                        file.
  --appid APPID         Takes the form {user or division}/{project}/{app_id}.
  --workflow-path WORKFLOW_PATH
                        Path to the main workflow directory
  --entrypoint ENTRYPOINT
                        Relative path to the workflow from the main workflow
                        directory. If not provided, 'main.nf' will be used if
                        available. If not available, but a single '*.nf' is
                        located in the workflow-path will be used. If more
                        than one '*.nf' script is detected, an error is
                        raised.
  --sb-package-id SB_PACKAGE_ID
                        Id of an already uploaded package.
  --sb-doc SB_DOC       Path to a doc file for sb app. If not provided,
                        README.md will be used if available
  --dump-sb-app         Dump created sb app to file if true and exit
  --executor-version EXECUTOR_VERSION
                        Version of the Nextflow executor to be used with the
                        app.
  --execution-mode {single-instance,multi-instance}
                        Execution mode for your application. Can be multi-
                        instance or single-instance
  --json                Dump sb app schema in JSON format (YAML by default)
  --sb-schema SB_SCHEMA
                        Do not create new schema, use this schema file. It is
                        sb_nextflow_schema in JSON or YAML format.
  --revision-note REVISION_NOTE
                        Revision note to be placed in the CWL schema if the
                        app is uploaded to the sbg platform.
  --app-name APP_NAME   Name of the app to be shown on the platform.
  --exclude EXCLUDE [EXCLUDE ...]
                        Glob patterns you want to exclude from the code
                        package. By default the following patterns are
                        excluded: ['*.git', '*.git*', '.git', '.git*', 'work',
                        '.nextflow.log', '.DS_Store', '.devcontainer',
                        '.editorconfig', '.gitattributes', '.nextflow', '.pre-
                        commit-config.yaml', '.prettierignore',
                        '.prettierrc.yml', '.idea', '.pytest_cache', '*.egg-
                        info']
  --sample-sheet-schema SAMPLE_SHEET_SCHEMA
                        Path to the sample sheet schema yaml. The sample sheet
                        schema should contain the following keys:
                        'sample_sheet_input', 'sample_sheet_name', 'header',
                        'rows', 'defaults', 'group_by', 'format_'
  --auto                Automatically detect all possible inputs directly from
                        the --workflow-path location

```
### Example

```
$ sbpack_nf --profile default --workflow-path /path/to/workflow_dir  
--appid user/project/app --entrypoint main.nf
```

# sbcopy

Developed to enable deep copying of Nextflow and WDL apps on the SB platform between projects.
This tool also allows copying between divisions and platforms. When used to perform this copy action, it requires credentials for both the source and the destination environment. Both are provided to the `--profile` argument in the source, target order. 
Note: The link between the original, and the new app will not be available.

### Usage

```
sbcopy -h
usage: sbcopy [-h]
              [--profile PROFILE [PROFILE ...]]
              --appid APPID 
              --projectid PROJECTID

optional arguments:
  -h, --help            show this help message and exit
  --profile PROFILE [PROFILE ...]
                        SB platform profile as set in the SB API credentials
                        file. If you are using sbcopy to copy an app from one
                        division to another, please provide two profiles -
                        first profile for the source app (appid), and second
                        for the destination project (projectid).
  --appid APPID         What to copy? Takes the form {user or
                        division}/{project}/{app_id} or {user or
                        division}/{project}/{app_id}/{revision_no}.
  --projectid PROJECTID
                        Where to copy? Takes the form {user or
                        division}/{project}

```

### Examples

Copying an app from one project to another within the same division.
```
sbcopy --appid division-name/project-name/app-name --projectid division-name/destination-project-name
```

Copying an app from one division to another.
```
sbcopy --profile source_division target_division --appid source-division-name/project-name/app-name --projectid target-division-name/destination-project-name
```

# sbmanifest

Developed to help remap file paths contained within a manifest file to platform
file locations. This is useful when utilizing sample sheets to run nextflow
pipelines on SB powered platforms.

### Usage

```
usage: sbmanifest [-h] [--profile PROFILE] --projectid PROJECTID
                  --sample-sheet SAMPLE_SHEET --columns string [string ...]
                  [--output OUTPUT] [--upload] [--tags string [string ...]]
                  [--validate]

optional arguments:
  -h, --help            show this help message and exit
  --profile PROFILE     SB platform profile as set in the SB API credentials
                        file.
  --projectid PROJECTID
                        Takes the form {user or division}/{project}.
  --sample-sheet SAMPLE_SHEET
                        Path to the sample sheet.
  --columns string [string ...]
                        Specify columns that contain paths to files on the
                        platformas a list of strings separated by spaces.
  --output OUTPUT, -o OUTPUT
                        Name of the output file.
  --upload, -u          Upload the file to the project after making it.
  --tags string [string ...]
                        Specify tags that you want the sample sheet to have on
                        the platform, after it is uploaded.
  --validate            Validate if each file exists on target project
                        location.
```

### Examples

Remap a sample sheet and upload it to the platform with the tag "SampleSheet"
```
sbmanifest --projectid user/project_id --sample-sheet /path/to/rnaseq_samplesheet.csv --columns fastq_1 fastq_2 -o rnaseq_samplesheet.csv -u --tags SampleSheet
```
Given the contents of this sample sheet is:

| sample  | fastq_1                          | fastq_2                          | strandedness |
|:--------|:---------------------------------|:---------------------------------|:-------------|
| SAMPLE1 | RNAseq_inputs/SAMPLE1_1.fastq.gz | RNAseq_inputs/SAMPLE1_2.fastq.gz | reverse      |
| SAMPLE2 | RNAseq_inputs/SAMPLE2_1.fastq.gz | RNAseq_inputs/SAMPLE2_2.fastq.gz | reverse      |


Remapped file will be:

| sample  | fastq_1                                                           | fastq_2                                                           | strandedness |
|:--------|:------------------------------------------------------------------|:------------------------------------------------------------------|:-------------|
| SAMPLE1 | vs:///Projects/project-root-uuid/RNAseq_inputs/SAMPLE1_1.fastq.gz | vs:///Projects/project-root-uuid/RNAseq_inputs/SAMPLE1_2.fastq.gz | reverse      |
| SAMPLE2 | vs:///Projects/project-root-uuid/RNAseq_inputs/SAMPLE2_1.fastq.gz | vs:///Projects/project-root-uuid/RNAseq_inputs/SAMPLE2_2.fastq.gz | reverse      |
